<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Production Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 10px;
            min-height: 100vh;
            overflow: hidden;
        }

        .container {
            max-width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 10px;
            animation: fadeIn 0.5s ease-in;
            flex-shrink: 0;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .datetime {
            font-size: 1em;
            opacity: 0.95;
            background: rgba(255, 255, 255, 0.1);
            padding: 6px 16px;
            border-radius: 20px;
            display: inline-block;
            backdrop-filter: blur(10px);
        }

        .section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: slideUp 0.6s ease-out;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .section:first-of-type {
            flex: 3;  /* 60% of space */
            margin-bottom: 6px;
            min-height: 0;
        }

        .section:last-of-type {
            flex: 2;  /* 40% of space */
            min-height: 0;
        }

        .section-title {
            font-size: 1em;
            color: #333;
            margin-bottom: 6px;
            padding-bottom: 4px;
            border-bottom: 2px solid #667eea;
            display:block;
            align-items: center;
            gap: 10px;
            flex-shrink: 0;
        }

        .section-title .icon {
            font-size: 1em;
        }

        .grid {
            display: grid;
            gap: 8px;
            flex: 1;
            min-height: 0;
            overflow: auto;
        }

        .machines-grid {
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(2, 1fr);
            height: 100%;
        }

        .assembly-grid {
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: 1fr;
            height: 100%;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border-left: 4px solid #667eea;
            position: relative;
            overflow: hidden;
            display:block;
            flex-direction: column;
            min-height: 0;
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, rgba(102,126,234,0.1) 0%, transparent 70%);
            border-radius: 50%;
            transform: translate(30%, -30%);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
            flex-shrink: 0;
        }

        .card-title {
            font-size: 0.85em;
            font-weight: bold;
            color: #333;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .card-title::before {
            content: '‚öôÔ∏è';
            font-size: 0.9em;
        }

        .status-badge {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.6em;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            animation: pulse 2s infinite;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .status-running {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .status-idle {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .status-unknown {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .card-content {
            margin-top: 4px;
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
            overflow: auto;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 3px 0;
            border-bottom: 1px solid #f0f0f0;
            flex-shrink: 0;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            color: #666;
            font-size: 0.7em;
            font-weight: 500;
        }

        .info-value {
            color: #333;
            font-weight: 600;
            font-size: 0.75em;
        }

        .time-section {
            margin-top: 6px;
            padding: 6px;
            background: linear-gradient(135deg, #f8f9ff 0%, #e8eeff 100%);
            border-radius: 6px;
            border: 2px solid #667eea;
            flex-shrink: 0;
        }

        .time-header {
            display: flex;
            align-items: center;
            gap: 4px;
            margin-bottom: 4px;
            color: #667eea;
            font-weight: 600;
            font-size: 0.7em;
        }

        .time-header::before {
            content: 'üïê';
            font-size: 0.9em;
        }

        .start-time {
            font-size: 0.7em;
            color: #555;
            margin-bottom: 3px;
            padding: 2px 4px;
            background: white;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .start-time-label {
            color: #888;
            font-size: 0.9em;
        }

        .start-time-value {
            font-weight: 600;
            color: #333;
        }

        .running-timer {
            font-size: 1.1em;
            color: #667eea;
            font-weight: bold;
            text-align: center;
            padding: 4px;
            background: white;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            letter-spacing: 1px;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
            transition: all 0.3s ease;
        }

        .running-timer.overtime {
            color: #ef4444;
            background: #fee2e2;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
            animation: blink 1.5s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .idle-message {
            text-align: center;
            color: #999;
            font-size: 0.75em;
            padding: 6px;
            font-style: italic;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 8px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 50%, #667eea 100%);
            background-size: 200% 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
            animation: shimmer 2s linear infinite;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.9;
                transform: scale(0.98);
            }
        }

        @keyframes shimmer {
            0% {
                background-position: 200% 0;
            }
            100% {
                background-position: -200% 0;
            }
        }

        /* Large Desktop (1920px+) */
        @media (min-width: 1920px) {
            .container {
                max-width: 1920px;
                margin: 0 auto;
            }
            
            .header h1 {
                font-size: 2.5em;
            }
            
            .section-title {
                font-size: 1.4em;
            }
            
            .card-title {
                font-size: 1.1em;
            }
            
            .info-label, .info-value {
                font-size: 0.95em;
            }
        }

        /* Tablet Landscape & Small Desktop (1024px - 1440px) */
        @media (max-width: 1440px) {
            .machines-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 10px;
            }
            
            .assembly-grid {
                grid-template-columns: repeat(5, 1fr);
                gap: 10px;
            }
            
            .card {
                padding: 10px;
            }
            
            .section {
                padding: 12px;
            }
        }

        /* Tablet Portrait & Small Laptop (768px - 1024px) */
        @media (max-width: 1024px) {
            body {
                padding: 8px;
                overflow-y: auto;
            }
            
            .container {
                height: auto;
                min-height: 100vh;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .section:first-of-type {
                flex: none;
                margin-bottom: 10px;
            }
            
            .section:last-of-type {
                flex: none;
            }
            
            .machines-grid {
                grid-template-columns: repeat(3, 1fr);
                grid-template-rows: auto;
                gap: 10px;
            }
            
            .assembly-grid {
                grid-template-columns: repeat(3, 1fr);
                grid-template-rows: auto;
                gap: 10px;
            }
            
            .grid {
                overflow: visible;
            }
            
            .card {
                padding: 10px;
            }
            
            .running-timer {
                font-size: 1.3em;
            }
        }

        /* Mobile Landscape (576px - 768px) */
        @media (max-width: 768px) {
            body {
                padding: 5px;
                overflow-y: auto;
            }
            
            .container {
                height: auto;
            }

            .header {
                margin-bottom: 8px;
            }

            .header h1 {
                font-size: 1.5em;
                margin-bottom: 3px;
            }
            
            .datetime {
                font-size: 0.85em;
                padding: 4px 12px;
            }
            
            .section {
                padding: 10px;
                margin-bottom: 8px;
            }
            
            .section-title {
                font-size: 1em;
                margin-bottom: 6px;
                padding-bottom: 4px;
            }
            
            .machines-grid {
                grid-template-columns: repeat(2, 1fr);
                grid-template-rows: auto;
                gap: 8px;
            }
            
            .assembly-grid {
                grid-template-columns: repeat(2, 1fr);
                grid-template-rows: auto;
                gap: 8px;
            }
            
            .card {
                padding: 8px;
            }
            
            .card-title {
                font-size: 0.9em;
            }
            
            .status-badge {
                font-size: 0.65em;
                padding: 3px 8px;
            }
            
            .info-label {
                font-size: 0.75em;
            }
            
            .info-value {
                font-size: 0.8em;
            }
            
            .time-section {
                padding: 8px;
                margin-top: 8px;
            }
            
            .time-header {
                font-size: 0.8em;
                margin-bottom: 6px;
            }
            
            .start-time {
                font-size: 0.75em;
                padding: 3px 6px;
                margin-bottom: 4px;
            }
            
            .start-time-label {
                font-size: 0.85em;
            }

            .running-timer {
                font-size: 1.1em;
                padding: 6px;
            }
        }

        /* Mobile Portrait (320px - 576px) */
        @media (max-width: 576px) {
            body {
                padding: 3px;
            }
            
            .header h1 {
                font-size: 1.2em;
            }
            
            .datetime {
                font-size: 0.75em;
                padding: 3px 10px;
            }
            
            .section {
                padding: 8px;
                border-radius: 10px;
            }
            
            .section-title {
                font-size: 0.95em;
            }
            
            .machines-grid,
            .assembly-grid {
                grid-template-columns: 1fr;
                grid-template-rows: auto;
                gap: 8px;
            }
            
            .card {
                padding: 10px;
            }
            
            .card-title {
                font-size: 0.95em;
            }
            
            .status-badge {
                font-size: 0.6em;
            }
            
            .info-row {
                padding: 5px 0;
            }
            
            .info-label {
                font-size: 0.8em;
            }
            
            .info-value {
                font-size: 0.85em;
            }
            
            .time-section {
                padding: 8px;
            }
            
            .time-header {
                font-size: 0.85em;
            }
            
            .start-time {
                font-size: 0.8em;
            }
            
            .running-timer {
                font-size: 1.2em;
                padding: 8px;
            }
            
            .idle-message {
                font-size: 0.8em;
                padding: 8px;
            }
        }

        /* Very Small Mobile (max 375px) */
        @media (max-width: 375px) {
            .header h1 {
                font-size: 1.1em;
            }
            
            .card-title {
                font-size: 0.85em;
            }
            
            .running-timer {
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Backend -->
    <script type="application/json" id="machineData">
        {{ machines | tojson }}
    </script>
    <script type="application/json" id="assemblyLineData">
        {{ assembly_lines | tojson }}
    </script>

    <div class="container">
        <div class="section">
            <div class="section-title">
                <span class="icon">üîß</span>
                <span>Split Machine Status</span>
            </div>
            <div class="grid machines-grid" id="machineGrid"></div>
        </div>

        <div class="section">
            <div class="section-title">
                <span class="icon">üèóÔ∏è</span>
                <span>Assembly Line Status</span>
            </div>
            <div class="grid assembly-grid" id="assemblyGrid"></div>
        </div>
    </div>

    <script>
        const machineData = JSON.parse(document.getElementById('machineData').textContent || '[]');
        const assemblyLineData = JSON.parse(document.getElementById('assemblyLineData').textContent || '[]');

        function formatDuration(startTimeISO) {
            if (!startTimeISO) return '-';
            
            const startTime = new Date(startTimeISO);
            const now = new Date();
            let diff = now - startTime;

            const startHour = startTime.getHours();
            const nowHour = now.getHours();

            if (startHour < 12 && nowHour >= 13) {
                diff -= 3600000;
            }
            else if (startHour < 12 && nowHour === 12) {
                const noon = new Date(now);
                noon.setHours(12, 0, 0, 0);
                diff = noon - startTime;
            }
            else if (startHour === 12) {
                const onepm = new Date(startTime);
                onepm.setHours(13, 0, 0, 0);
                if (now >= onepm) {
                    diff = now - onepm;
                } else {
                    diff = 0;
                }
            }

            diff -= 300000;

            if (diff < 0) diff = 0;
            
            const hours = Math.floor(diff / 3600000);
            const minutes = Math.floor((diff % 3600000) / 60000);
            const seconds = Math.floor((diff % 60000) / 1000);
            
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function formatStartTime(startTimeISO) {
            if (!startTimeISO) return '-';
            const date = new Date(startTimeISO);
            const options = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
            return date.toLocaleTimeString('th-TH', options);
        }

        function formatEndTime(startTimeISO, workTimeMinutes) {
            if (!startTimeISO || !workTimeMinutes) return '-';
            
            const startTime = new Date(startTimeISO);
            const endTime = new Date(startTime.getTime() + workTimeMinutes * 60000);
            
            // Check if work period crosses lunch break (12:00-13:00)
            const startHour = startTime.getHours();
            const endHour = endTime.getHours();
            
            // If start is before 12:00 and end is after 12:00, add 1 hour for lunch
            if (startHour < 12 && endHour >= 12) {
                endTime.setTime(endTime.getTime() + 3600000); // Add 1 hour
            }
            
            const options = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
            return endTime.toLocaleTimeString('th-TH', options);
        }

        function formatWorkTime(workTimeMinutes) {
            if (!workTimeMinutes) return '-';
            const hours = Math.floor(workTimeMinutes / 60);
            const minutes = Math.floor(workTimeMinutes % 60);
            return `${hours}:${minutes.toString().padStart(2, '0')}`;
        }

        function updateDateTime() {
            const now = new Date();
            const options = { 
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            };
            const datetimeElement = document.getElementById('datetime');
            if(datetimeElement) {
                datetimeElement.textContent = now.toLocaleDateString('th-TH', options);
            }
        }

        function calculateProgress(startTimeISO, workTimeMinutes) {
            if (!startTimeISO || !workTimeMinutes) return 0;
            
            const startTime = new Date(startTimeISO);
            const now = new Date();
            let diff = now - startTime;
            
            const startHour = startTime.getHours();
            const nowHour = now.getHours();
            
            // Adjust for lunch break (12:00-13:00)
            if (startHour < 12 && nowHour >= 13) {
                diff -= 3600000;  // Subtract 1 hour
            } else if (startHour < 12 && nowHour === 12) {
                const noon = new Date(now);
                noon.setHours(12, 0, 0, 0);
                diff = noon - startTime;
            } else if (startHour === 12) {
                const onepm = new Date(startTime);
                onepm.setHours(13, 0, 0, 0);
                if (now >= onepm) {
                    diff = now - onepm;
                } else {
                    diff = 0;
                }
            }
            
            // Subtract 5 minutes buffer
            diff -= 300000;
            
            if (diff < 0) diff = 0;
            
            // Convert diff to minutes
            const elapsedMinutes = diff / 60000;
            
            // Calculate progress: (elapsed / total) * 100
            const progress = (elapsedMinutes / workTimeMinutes) * 100;
            
            // Cap at 100%
            return Math.min(progress, 100);
        }

        function renderMachines() {
            const grid = document.getElementById('machineGrid');
            grid.innerHTML = machineData.map(machine => {
                const statusClass = `status-${machine.status.toLowerCase()}`;
                const statusText = {
                    'Running': 'Running',
                    'Idle': 'Idle',
                    'Unknown': 'Error'
                }[machine.status] || machine.status;
                
                let timeContent = '';
                if (machine.status === 'Running' && machine.time_start_iso) {
                    const workTime = machine.work_time || 0;
                    const progress = calculateProgress(machine.time_start_iso, workTime);
                    timeContent = `
                        <div class="progress-bar" hidden>
                            <div class="progress-fill" style="width: ${progress}%;" data-start="${machine.time_start_iso}" data-worktime="${workTime}"></div>
                        </div>
                        <div class="time-section">
                            <div class="time-header">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</div>
                            <div class="start-time">
                                <span class="start-time-label">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏ß‡∏•‡∏≤:</span>
                                <span class="start-time-value">${formatStartTime(machine.time_start_iso)}</span>
                            </div>
                            <div class="start-time">
                                <span class="start-time-label">‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡πÄ‡∏ß‡∏•‡∏≤:</span>
                                <span class="start-time-value">${formatEndTime(machine.time_start_iso, workTime)}</span>
                            </div>
                            <div class="start-time">
                                <span class="start-time-label">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤:</span>
                                <span class="start-time-value">${formatWorkTime(workTime)}</span>
                            </div>
                            <div class="running-timer" data-start="${machine.time_start_iso}" data-worktime="${workTime}">
                                ${formatDuration(machine.time_start_iso)}
                            </div>
                        </div>
                    `;
                } else {
                    timeContent = `
                        <div class="time-section">
                            <div class="idle-message">‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</div>
                        </div>
                    `;
                }
                
                return `
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">${machine.name}</div>
                            <div class="status-badge ${statusClass}">${statusText}</div>
                        </div>
                        <div class="card-content">
                            <div class="info-row">
                                <span class="info-label">Sequence: ${machine.sequence || '-'}</span>
                                <span class="info-value">${machine.model || '-'}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Size:</span>
                                <span class="info-value">${machine.size || '-'}</span>
                            </div>
                            ${timeContent}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderAssemblyLines() {
            const grid = document.getElementById('assemblyGrid');
            grid.innerHTML = assemblyLineData.map(assy => {
                const statusClass = `status-${assy.status.toLowerCase()}`;
                const statusText = {
                    'Running': 'Running',
                    'Idle': 'Idle',
                    'Unknown': 'Error'
                }[assy.status] || assy.status;
                
                let timeContent = '';
                if (assy.status === 'Running' && assy.time_start_iso) {
                    const workTime = assy.work_time || 0;
                    const progress = calculateProgress(assy.time_start_iso, workTime);
                    timeContent = `
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progress}%;" data-start="${assy.time_start_iso}" data-worktime="${workTime}"></div>
                        </div>
                        <div class="time-section">
                            <div class="time-header">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</div>
                            <div class="start-time">
                                <span class="start-time-label">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏ß‡∏•‡∏≤:</span>
                                <span class="start-time-value">${formatStartTime(assy.time_start_iso)}</span>
                            </div>
                            <div class="start-time">
                                <span class="start-time-label">‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡πÄ‡∏ß‡∏•‡∏≤:</span>
                                <span class="start-time-value">${formatEndTime(assy.time_start_iso, workTime)}</span>
                            </div>
                            <div class="start-time">
                                <span class="start-time-label">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤:</span>
                                <span class="start-time-value">${formatWorkTime(workTime)}</span>
                            </div>
                            <div class="running-timer" data-start="${assy.time_start_iso}" data-worktime="${workTime}">
                                ${formatDuration(assy.time_start_iso)}
                            </div>
                        </div>
                    `;
                } else {
                    timeContent = `
                        <div class="time-section">
                            <div class="idle-message">‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</div>
                        </div>
                    `;
                }
                
                return `
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">${assy.name}</div>
                            <div class="status-badge ${statusClass}">${statusText}</div>
                        </div>
                        <div class="card-content">
                            <div class="info-row">
                                <span class="info-label">Model:</span>
                                <span class="info-value">${assy.model || '-'}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Sequence:</span>
                                <span class="info-value">${assy.sequence || '-'}</span>
                            </div>
                            ${timeContent}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateTimers() {
            // Update running timers (elapsed time)
            document.querySelectorAll('.running-timer[data-start]').forEach(timer => {
                const startTimeISO = timer.dataset.start;
                const workTimeMinutes = parseFloat(timer.dataset.worktime) || 0;
                
                // Update timer text
                timer.textContent = formatDuration(startTimeISO);
                
                // Check if overtime (elapsed time > work_time)
                if (workTimeMinutes > 0) {
                    const startTime = new Date(startTimeISO);
                    const now = new Date();
                    let elapsedMinutes = (now - startTime) / 60000;
                    
                    // Adjust for lunch break
                    const startHour = startTime.getHours();
                    const nowHour = now.getHours();
                    if (startHour < 12 && nowHour >= 13) {
                        elapsedMinutes -= 60;
                    }
                    
                    // Subtract 5 minutes buffer
                    elapsedMinutes -= 5;
                    
                    // Add or remove overtime class
                    if (elapsedMinutes > workTimeMinutes) {
                        timer.classList.add('overtime');
                    } else {
                        timer.classList.remove('overtime');
                    }
                }
            });

            // Update progress bars
            document.querySelectorAll('.progress-fill[data-start]').forEach(progress => {
                const startTimeISO = progress.dataset.start;
                const workTime = parseFloat(progress.dataset.worktime) || 0;
                const newProgress = calculateProgress(startTimeISO, workTime);
                progress.style.width = `${newProgress}%`;
            });

            // Note: We don't update .start-time-value because they are static values
            // (start time, end time, and work duration don't change)
        }

        renderMachines();
        renderAssemblyLines();
        updateDateTime();

        setInterval(() => {
            updateTimers();
            updateDateTime();
        }, 1000);

        setInterval(() => {
            location.reload();
        }, 300000);
    </script>
</body>
</html>